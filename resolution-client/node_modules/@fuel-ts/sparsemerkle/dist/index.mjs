import{hash as F}from"@fuel-ts/merkle-shared";import{hash as Z}from"@fuel-ts/merkle-shared";import{hash as x}from"@fuel-ts/merkle-shared";var A="0x00",R="0x01";function M(o,t){let e="0x00".concat(o.slice(2)).concat(x(t).slice(2));return[x(e),e]}function d(o,t){let e="0x01".concat(o.slice(2)).concat(t.slice(2));return[x(e),e]}function S(o){let t=R.length;return["0x".concat(o.slice(t,t+64)),"0x".concat(o.slice(t+64))]}function B(o){let t=R.length;return["0x".concat(o.slice(t,t+64)),"0x".concat(o.slice(t+64))]}function b(o){return o.slice(0,4)===A}var P=class{SideNodes;NonMembershipLeafData;BitMask;NumSideNodes;SiblingData;constructor(t,e,r,n,f){this.SideNodes=t,this.NonMembershipLeafData=e,this.BitMask=r,this.NumSideNodes=n,this.SiblingData=f}},C=P;var D=class{SideNodes;NonMembershipLeafData;SiblingData;constructor(t,e,r){this.SideNodes=t,this.NonMembershipLeafData=e,this.SiblingData=r}},L=D;var l="0x0000000000000000000000000000000000000000000000000000000000000000";function p(o,t){let e=o.slice(2),r="0x".concat(e.slice(Math.floor(t/8)*2,Math.floor(t/8)*2+2));return(Number(r)&1<<8-1-t%8)>0?1:0}function k(o){let t=0,e=o.length-1,r=o;for(;t<e;)[r[t],r[e]]=[r[e],r[t]],t+=1,e-=1;return r}function v(o,t){let e=0;for(let r=0;r<256&&p(o,r)===p(t,r);r+=1)e+=1;return e}function E(o){let t=[],e=[],r;for(let f=0;f<o.SideNodes.length;f+=1)r=o.SideNodes[f],r===l?t.push(0):(e.push(r),t.push(1));return new C(e,o.NonMembershipLeafData,t,o.SideNodes.length,o.SiblingData)}var H=class{ms;root;constructor(){let t={};this.ms=t,this.root=l,this.ms[this.root]=l}get(t){return this.ms[t]}set(t,e){this.ms[t]=e}setRoot(t){this.root=t}sideNodesForRoot(t,e){let r=[];if(e===l)return[r,l,"",""];let n=this.get(e);if(b(n))return[r,e,n,""];let f,i,s="",c="";for(let h=0;h<256;h+=1){if([f,i]=B(n),p(t,h)===1?(c=f,s=i):(c=i,s=f),r.push(c),s===l){n="";break}if(n=this.get(s),b(n))break}let a=this.get(c);return[k(r),s,n,a]}deleteWithSideNodes(t,e,r,n){if(r===l)return this.root;let[f]=S(n);if(f!==t)return this.root;let i="",s="",c="",a="",h=!1;for(let g=0;g<e.length;g+=1)if(e[g]!==""){if(c=e[g],s==="")if(a=this.get(c),b(a)){i=c,s=c;continue}else s=l,h=!0;!h&&c===l||(h||(h=!0),p(t,e.length-1-g)===1?[i,s]=d(c,s):[i,s]=d(s,c),this.set(i,s),s=i)}return i===""&&(i=l),i}updateWithSideNodes(t,e,r,n,f){let i,s;this.set(F(e),e),[i,s]=M(t,e),this.set(i,s),s=i;let c;if(n===l)c=256;else{let[a]=S(f);c=v(t,a)}c!==256&&(p(t,c)===1?[i,s]=d(n,s):[i,s]=d(s,n),this.set(i,s),s=i);for(let a=0;a<256;a+=1){let h,g=256-r.length;if(a-g<0||r[a-g]==="")if(c!==256&&c>256-1-a)h=l;else continue;else h=r[a-g];p(t,256-1-a)===1?[i,s]=d(h,s):[i,s]=d(s,h),this.set(i,s),s=i}return i}update(t,e){let[r,n,f]=this.sideNodesForRoot(t,this.root),i;e===l?i=this.deleteWithSideNodes(t,r,n,f):i=this.updateWithSideNodes(t,e,r,n,f),this.setRoot(i)}delete(t){this.update(t,l)}prove(t){let[e,r,n,f]=this.sideNodesForRoot(t,this.root),i=[];for(let a=0;a<e.length;a+=1)e[a]!==""&&i.push(e[a]);let s="";if(r!==l){let[a]=S(n);a!==t&&(s=n)}return new L(i,s,f)}proveCompacted(t){let e=this.prove(t);return E(e)}},w=H;export{w as default};
//# sourceMappingURL=index.mjs.map